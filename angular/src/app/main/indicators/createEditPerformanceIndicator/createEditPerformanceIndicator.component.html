<div [@routerTransition]>
    <div class="kt-content  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">
        <div class="kt-subheader kt-grid__item">
            <div class="kt-container ">
                <div class="kt-subheader__main">
                    <h3 class="kt-subheader__title">
                        <span *ngIf="performanceIndicator.id">{{l("EditPerformanceIndicator")}}</span>
                        <span *ngIf="!performanceIndicator.id">{{l("CreateNewPerformanceIndicator")}}</span>
                    </h3>
                    <span class="kt-subheader__separator kt-subheader__separator--v"></span>
                    <span class="kt-subheader__desc">
                    </span>
                </div>
                <div class="kt-subheader__toolbar">
                    <div class="kt-subheader__wrapper">
                        <button (click)="goBack()" class="btn btn-outline-primary blue">
                            <i class="fa fa-reply"></i>
                            {{l("Back")}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="kt-container kt-grid__item kt-grid__item--fluid">
            <div class="kt-portlet kt-portlet--mobile">
                <div class="kt-portlet__body">

                    <form *ngIf="active" #performanceIndicatorForm="ngForm" novalidate (ngSubmit)="save()" autocomplete="off">

                        <div class="form-group">
                            <label for="performanceIndicator_Name">{{l("Name")}} <span class="kt-font-danger">*</span></label>
                            <input type="text" id="performanceIndicator_Name" class="form-control"
                                [(ngModel)]="performanceIndicator.name" name="Name" required />
                        </div>
    
                        <div class="form-group">
                            <label for="performanceIndicator_Description">{{l("Description")}}</label>
                            <textarea id="performanceIndicator_Description" class="form-control" rows="5"
                                [(ngModel)]="performanceIndicator.description" name="Description"></textarea>
                        </div>

                        <div class="form-group row">
                            <div class="col-md-6">
                                <label for="performanceIndicator_DataType">{{l("DataType")}} <span class="kt-font-danger">*</span></label>
                                <select id="performanceIndicator_DataType" class="form-control" required
                                    [(ngModel)]="performanceIndicator.dataType" name="DataType">
                                    <option [value]="dataTypeEnum.Number">Number</option>
                                    <option [value]="dataTypeEnum.DateTime">DateTime</option>
                                    <option [value]="dataTypeEnum.Boolean">Boolean</option>
                                </select>
                            </div>
                            
                            <div *ngIf="performanceIndicator.dataType == dataTypeEnum.Number" class="col-md-6">
                                <label for="performanceIndicator_Unit">{{l("Unit")}}</label>
                                <select id="performanceIndicator_Unit" class="form-control"
                                    [(ngModel)]="performanceIndicator.unit" name="Unit">
                                    <option [value]="unitEnum.None">None</option>
                                    <option [value]="unitEnum.Count">Count</option>
                                    <option [value]="unitEnum.Percentage">Percentage</option>
                                    <option [value]="unitEnum.Money">Money (NGN)</option>
                                </select>
                            </div>
                        </div>
    
                        <div class="form-group row">
                            <div class="col-md-6">
                                <label for="performanceIndicator_BaselineValue">{{l("BaselineValue")}}</label>
                                <p *ngIf="performanceIndicator.dataType === undefined" class="kt-font-danger">Please select a data type</p>
    
                                <div *ngIf="performanceIndicator.dataType == dataTypeEnum.Number" class="input-group">
                                    <div *ngIf="performanceIndicator.unit == unitEnum.Money" class="input-group-prepend">
                                        <span class="input-group-text">NGN</span>								
                                    </div>
                                    <input type="number" id="performanceIndicator_BaselineValue" class="form-control" 
                                        [(ngModel)]="performanceIndicator.baselineValue" name="BaselineValue" />
                                    <div *ngIf="performanceIndicator.unit == unitEnum.Percentage" class="input-group-append">
                                        <span class="input-group-text"><i class="fa fa-percent"></i></span>
                                    </div>
                                </div>
                                
                                <input *ngIf="performanceIndicator.dataType == dataTypeEnum.DateTime" type="date" id="performanceIndicator_BaselineValue" class="form-control"
                                    [(ngModel)]="performanceIndicator.baselineValue" name="BaselineValue" />
                                <select *ngIf="performanceIndicator.dataType == dataTypeEnum.Boolean" id="performanceIndicator_BaselineValue" class="form-control"
                                    [(ngModel)]="performanceIndicator.baselineValue" name="BaselineValue">
                                    <option [value]="true">Yes</option>
                                    <option [value]="false">No</option>
                                </select>
                            </div>
                        </div>
    
                        <div class="form-group row">
                            <div class="col-md-8">
                                <label for="performanceIndicator_BaselineComment">{{l("BaselineComment")}}</label>
                                <textarea id="performanceIndicator_BaselineComment" class="form-control" rows="3"
                                    [(ngModel)]="performanceIndicator.baselineComment" name="BaselineComment"></textarea>
                            </div>
                        </div>
    
                        <hr/><br>
    
                        <button type="button" class="btn btn-outline-{{!showYearlyTargetForm ? 'primary' : 'danger'}} mb-2" (click)="showYearlyTargetForm = !showYearlyTargetForm">
                            <i class="fa fa-{{!showYearlyTargetForm ? 'plus' : 'times'}}"></i> 
                            {{!showYearlyTargetForm ? 'Add Target' : 'Cancel'}}
                        </button>
    
                        <div *ngIf="showYearlyTargetForm" class="form-group row">
                            <div class="col-md-5">
                                <label for="target_Year">{{l("Year")}}</label>
                                <input type="number" id="target_Year" class="form-control" min="1000" max="9999"
                                    [(ngModel)]="target.year" name="Year" />
                            </div>
                            <div class="col-md-5">
                                <label for="target_Target">{{l("Target")}}</label>
                                <p *ngIf="performanceIndicator.dataType === undefined" class="kt-font-danger">Please select a data type</p>
    
                                <div *ngIf="performanceIndicator.dataType == dataTypeEnum.Number" class="input-group">
                                    <div *ngIf="performanceIndicator.unit == unitEnum.Money" class="input-group-prepend">
                                        <span class="input-group-text">NGN</span>								
                                    </div>
                                    <input type="number" id="target_Target" class="form-control" [(ngModel)]="target.target" name="target_Target" />
                                    <div *ngIf="performanceIndicator.unit == unitEnum.Percentage" class="input-group-append">
                                        <span class="input-group-text"><i class="fa fa-percent"></i></span>
                                    </div>
                                </div>
                                
                                <input *ngIf="performanceIndicator.dataType == dataTypeEnum.DateTime" type="date" id="target_Target" class="form-control"
                                    [(ngModel)]="target.target" name="target_Target" />
                                <select *ngIf="performanceIndicator.dataType == dataTypeEnum.Boolean" id="target_Target" class="form-control"
                                    [(ngModel)]="target.target" name="target_Target">
                                    <option [value]="true">Yes</option>
                                    <option [value]="false">No</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="col" for="Blanc">&nbsp;</label>
                                <button class="btn btn-outline-success btn-icon" type="button" (click)="addTarget()">
                                    <i class="fa fa-save"></i>
                                </button>
                            </div>
                        </div>
    
                        <div class="table-responsive">
                            <hr>
                            <h3>Targets</h3>
                            <table class="table">
                                <thead>
                                    <tr class="d-flex">
                                        <th class="col-md">Year</th>
                                        <th class="col-md">Target</th>
                                        <th class="col-md"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="d-flex" *ngFor="let item of yearlyTargets; let i = index;">
                                        <td class="col-md">{{item.year}}</td>
                                        <td class="col-md">
                                            {{performanceIndicator.unit == unitEnum.Money ? 'NGN ' : ''}}
                                            {{item.target | number: '1.0-2'}}
                                            {{performanceIndicator.unit == unitEnum.Percentage ? '%' : ''}}
                                        </td>
                                        <td class="col-md">
                                            <button class="btn btn-sm btn-outline-danger btn-icon" type="button" (click)="removeTarget(i)">
                                                <i class="fa fa-times"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr *ngIf="yearlyTargets.length <= 0">
                                        <td colspan="3">No targets added</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="kt-margin-t-40">
                            <button [disabled]="saving" type="button" class="btn btn-default"
                                (click)="goBack()">{{l("Cancel")}}</button>
                            <button type="submit" class="btn btn-primary blue" [disabled]="!performanceIndicatorForm.form.valid"
                                [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')"><i class="fa fa-save"></i>
                                <span>{{l("Save")}}</span></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
